<section>
  <h2>Detalles</h2>
  @if (document) {
  <div class="document-details">
    <div class="document-details__actions">
      @if(permissions.update) {
      <button
        [routerLink]="['/main/editar', document.id.toString()]"
        class="edit"
      >
        Editar
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
        >
          <path
            fill="#currentColor"
            d="M6 22q-.825 0-1.412-.587T4 20V4q0-.825.588-1.412T6 2h8l6 6v3q-.575.125-1.075.4t-.925.7l-6 5.975V22zm8 0v-3.075l5.525-5.5q.225-.225.5-.325t.55-.1q.3 0 .575.113t.5.337l.925.925q.2.225.313.5t.112.55t-.1.563t-.325.512l-5.5 5.5zm6.575-5.6l.925-.975l-.925-.925l-.95.95zM13 9h5l-5-5l5 5l-5-5z"
          />
        </svg>
      </button>
      } @if(permissions.delete) {
      <button class="delete" (click)="openDialog()">
        Eliminar
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
        >
          <path
            fill="#currentColor"
            d="M7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21zm2-4h2V8H9zm4 0h2V8h-2z"
          />
        </svg>
      </button>
      }
    </div>
    <div class="document-header">
      <h2>{{ document.title }}</h2>
      <p class="ref-id">#{{ document.reference_number }}</p>
    </div>
    <div class="info-card">
      <h4>Descripci√≥n</h4>
      <p>{{ document.description }}</p>
    </div>
    <div class="info-grid">
      <div class="info-card">
        <h4>Tipo de documento</h4>
        <p>{{ document.category.name }}</p>
      </div>
      <div class="info-card estatus_{{ document.status_id }}">
        <h4 style="color: black">Estado</h4>
        <p style="font-weight: bold">{{ document.status.name }}</p>
      </div>
      <div class="info-card">
        <h4>Prioridad</h4>
        <p class="{{ document.priority }}" style="font-weight: bold">
          {{ document.priority }}
        </p>
      </div>
    </div>
    <div class="info-grid">
      <div class="info-card">
        <h4>üìÖ Fecha de creaci√≥n</h4>
        <p>{{ document.created_at }}</p>
      </div>
      <div class="info-card">
        <h4>üì• Fecha de recepci√≥n</h4>
        <p>{{ document.received_date }}</p>
      </div>
    </div>

    <div class="info-grid">
      <div class="info-card">
        <h4>üè¢ Departamento de Env√≠o</h4>
        <p>{{ document.sender_department.name }}</p>
      </div>
      <div class="info-card">
        <h4>üè¨ Departamento de Recepci√≥n</h4>
        <p>{{ document.receiver_department.name }}</p>
      </div>
    </div>

    <div class="info-card">
      <h4>Creado por</h4>
      <p>{{ document.user.name }}</p>
    </div>
  </div>
  <div class="document-details">
    <div class="document-header">
      <h3>Docuentos adjuntos</h3>
    </div>
    <div class="info-grid">
      <ul class="file-list">
        @for (file of files; track $index) {
        <li class="file-list__item">
          <button
            class="file-list__item_button"
            (click)="descargafile(file.id)"
          >
            <div class="file-icon">
              @switch (file.file_extension) { @case ("pdf") {
              <app-pdf></app-pdf>
              } @case ("docx") {
              <app-doc></app-doc>
              } @case ("xlsx") {
              <app-xlsx></app-xlsx>
              } }
            </div>
            {{ file.original_name }}
          </button>
          <button (click)="previewfile(file.id)" class="preview">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2048 2048">
              <path
                fill="currentColor"
                d="M1024 768q79 0 149 30t122 82t83 123t30 149q0 80-30 149t-82 122t-123 83t-149 30q-80 0-149-30t-122-82t-83-122t-30-150q0-79 30-149t82-122t122-83t150-30m0 640q53 0 99-20t82-55t55-81t20-100q0-53-20-99t-55-82t-81-55t-100-20q-53 0-99 20t-82 55t-55 81t-20 100q0 53 20 99t55 82t81 55t100 20m0-1152q143 0 284 35t266 105t226 170t166 234q40 83 61 171t21 181h-128q0-118-36-221t-99-188t-150-152t-185-113t-209-70t-217-24q-108 0-217 24t-208 70t-186 113t-149 152t-100 188t-36 221H0q0-92 21-180t61-172q64-132 165-233t227-171t266-104t284-36"
              />
            </svg>
          </button>
        </li>
        }@empty {
          Sin Archivos
        }
      </ul>
    </div>
    <br />
    <hr />
    <form class="form" [formGroup]="filesform" (ngSubmit)="onSubmit()">
      <fieldset class="form-group description">
        Adjuntar Documento (PDF, DOCX, XLSX)
        <label for="files" class="file-label">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path
              fill="currentColor"
              d="M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h5.175q.4 0 .763.15t.637.425L12 6h9q.425 0 .713.288T22 7t-.288.713T21 8h-9.825l-2-2H4v12l1.975-6.575q.2-.65.738-1.037T7.9 10h12.9q1.025 0 1.613.813t.312 1.762l-1.8 6q-.2.65-.737 1.038T19 20zm2.1-2H19l1.8-6H7.9zM4 11.45V6zM6.1 18l1.8-6z"
            />
          </svg>
          Arraste el archivo aqu√≠ o haga clic para seleccionar
          <input
            type="file"
            id="document_file"
            name="document_file"
            (change)="onFileArraySelected($event)"
            accept=".pdf, .docx, .xlsx"
            class="file-input"
          />
        </label>
        <ul class="file-list">
          @for (archivo of archivosSubidos; track $index) {
          <li class="file-info">
            <div class="file-icon">
              @switch (archivo.tipo) { @case ("pdf") {
              <app-pdf></app-pdf>
              } @case ("docx") {
              <app-doc></app-doc>
              } @case ("xlsx") {
              <app-xlsx></app-xlsx>
              } }
            </div>
            <p>{{ archivo.nombre }}</p>
            <button
              type="button"
              class="delete-file"
              (click)="eliminarArchivo(archivo.id)"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                <g fill="currentColor">
                  <path
                    d="M224 128a96 96 0 1 1-96-96a96 96 0 0 1 96 96"
                    opacity=".2"
                  />
                  <path
                    d="M165.66 101.66L139.31 128l26.35 26.34a8 8 0 0 1-11.32 11.32L128 139.31l-26.34 26.35a8 8 0 0 1-11.32-11.32L116.69 128l-26.35-26.34a8 8 0 0 1 11.32-11.32L128 116.69l26.34-26.35a8 8 0 0 1 11.32 11.32M232 128A104 104 0 1 1 128 24a104.11 104.11 0 0 1 104 104m-16 0a88 88 0 1 0-88 88a88.1 88.1 0 0 0 88-88"
                  />
                </g>
              </svg>
            </button>
          </li>
          }
        </ul>
      </fieldset>
      <button type="submit" class="btn-save">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="1em"
          height="1em"
          viewBox="0 0 24 24"
        >
          <path
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 21H7m10 0h.803c1.118 0 1.677 0 2.104-.218c.377-.192.683-.498.875-.874c.218-.427.218-.987.218-2.105V9.22c0-.45 0-.675-.048-.889a2 2 0 0 0-.209-.545c-.106-.19-.256-.355-.55-.682l-2.755-3.062c-.341-.378-.514-.57-.721-.708a2 2 0 0 0-.61-.271C15.863 3 15.6 3 15.075 3H6.2c-1.12 0-1.68 0-2.108.218a2 2 0 0 0-.874.874C3 4.52 3 5.08 3 6.2v11.6c0 1.12 0 1.68.218 2.107c.192.377.497.683.874.875c.427.218.987.218 2.105.218H7m10 0v-3.803c0-1.118 0-1.678-.218-2.105a2 2 0 0 0-.875-.874C15.48 14 14.92 14 13.8 14h-3.6c-1.12 0-1.68 0-2.108.218a2 2 0 0 0-.874.874C7 15.52 7 16.08 7 17.2V21m8-14H9"
          />
        </svg>
      </button>
    </form>
  </div>
  <section>
    Comentarios
    <div class="af7">
          <div class="ag5">
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 64 64"><path fill="currentColor" d="M32 36.8c8.3 0 15-6.7 15-15s-6.7-15-15-15s-15 6.7-15 15s6.7 15 15 15m0-25.5c5.8 0 10.5 4.7 10.5 10.5S37.8 32.3 32 32.3s-10.5-4.7-10.5-10.5S26.2 11.3 32 11.3m29.5 41.9C53.3 46.3 42.9 42.5 32 42.5S10.7 46.3 2.5 53.2c-.9.8-1.1 2.2-.3 3.2c.8.9 2.2 1.1 3.2.3C12.8 50.4 22.2 47 32 47s19.2 3.4 26.5 9.6c.4.4.9.5 1.5.5s1.3-.3 1.7-.8c.8-.9.7-2.3-.2-3.1"/></svg>
             <form [formGroup]="commentForm" (ngSubmit)="postComment()" class="ac2">
              <div class="ac5 brillo" title="Facebook's comment">
              <textarea formControlName="comment" placeholder="Escribe un comentario..."  class="no-comments"></textarea>                
                <p class="ac3"></p>
              </div>
              <div class="ac1">
                <u>
                  <button type="submit" [disabled]="postingComment" class="text-blue-500 hover:underline">Comentar</button>
                </u>
              </div>
            </form>
          </div>
    </div>
    <section class="aa0">
      @for (comment of coments; track $index) {
        <div class="af9">
        <div class="af7">
          <div class="ag5">
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 64 64"><path fill="currentColor" d="M32 36.8c8.3 0 15-6.7 15-15s-6.7-15-15-15s-15 6.7-15 15s6.7 15 15 15m0-25.5c5.8 0 10.5 4.7 10.5 10.5S37.8 32.3 32 32.3s-10.5-4.7-10.5-10.5S26.2 11.3 32 11.3m29.5 41.9C53.3 46.3 42.9 42.5 32 42.5S10.7 46.3 2.5 53.2c-.9.8-1.1 2.2-.3 3.2c.8.9 2.2 1.1 3.2.3C12.8 50.4 22.2 47 32 47s19.2 3.4 26.5 9.6c.4.4.9.5 1.5.5s1.3-.3 1.7-.8c.8-.9.7-2.3-.2-3.1"/></svg>
            <div class="ac2">
              <div class="ac5" title="Facebook's comment">
                <p class="ac4">{{comment.user.name}}</p>
                <p class="ac3">{{comment.comment}}</p>
              </div>
              <div class="ac1">
                <u>{{comment.created_at}}</u>
                <u>Comentar</u>
              </div>
            </div>
          </div>
          @if(comment.replies.length) {
            <div class="ag5">
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 64 64"><path fill="currentColor" d="M32 36.8c8.3 0 15-6.7 15-15s-6.7-15-15-15s-15 6.7-15 15s6.7 15 15 15m0-25.5c5.8 0 10.5 4.7 10.5 10.5S37.8 32.3 32 32.3s-10.5-4.7-10.5-10.5S26.2 11.3 32 11.3m29.5 41.9C53.3 46.3 42.9 42.5 32 42.5S10.7 46.3 2.5 53.2c-.9.8-1.1 2.2-.3 3.2c.8.9 2.2 1.1 3.2.3C12.8 50.4 22.2 47 32 47s19.2 3.4 26.5 9.6c.4.4.9.5 1.5.5s1.3-.3 1.7-.8c.8-.9.7-2.3-.2-3.1"/></svg>
            <div class="ac2">
              <div class="ac5" title="Facebook's comment">
                <p class="ac4">Roberval Callegari</p>
                <p class="ac3">No suffering at all üí™</p>
              </div>
              <div class="ac1">
                <u>{{comment.replies}}</u>
              </div>
            </div>
          </div>
          }
        </div>
        </div>  
      }@empty {
      <p class="no-comments">No hay comentarios</p>
      }
      
    </section>
  </section>
  }
@if(previewisvisible){
<div class="modal-overlay">
  <button class="close-button" (click)="closePreview()">‚úï</button>
  <iframe [src]="safeUrl" width="100%" height="100%" frameborder="0"> </iframe>
</div>
}
